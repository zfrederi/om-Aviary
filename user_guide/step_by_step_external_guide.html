

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Step-by-step guide for creating, testing, and using external subsystems</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/step_by_step_external_guide';</script>
    <link rel="shortcut icon" href="../_static/aviary_logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="In-depth look at the battery subsystem as an example" href="battery_subsystem_example.html" />
    <link rel="prev" title="Using external subsystems" href="using_external_subsystems.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/aviary.png" class="logo__image only-light" alt=" - Home"/>
    <script>document.write(`<img src="../_static/aviary.png" class="logo__image only-dark" alt=" - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Aviary Documentation
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/what_aviary_does.html">What Aviary Does</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/tools_that_aviary_uses.html">Tools That Aviary is Built Upon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/expected_user_knowledge.html">Expected User Knowledge</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../getting_started/onboarding.html">Onboarding Guide</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/onboarding_level1.html">Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/onboarding_level2.html">Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/onboarding_level3.html">Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/onboarding_ext_subsystem.html">Models with External Subsystems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/input_csv_phase_info.html">Vehicle Input .csv File and Phase_info Dictionary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/now_what.html">Now What?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="user_interface.html">Aviary User Interface</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="UI_Levels.html">User Interface Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples_of_the_same_mission_at_different_UI_levels.html">Examples of the same mission at different UI levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="aviary_commands.html">Command Line Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="input_files.html">Input Files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="drawing_and_running_simple_missions.html">Drawing and running simple missions</a></li>
<li class="toctree-l1"><a class="reference internal" href="pre_mission_and_mission.html">Pre-Mission and Mission</a></li>
<li class="toctree-l1"><a class="reference internal" href="outputs_and_how_to_read_them.html">Outputs and How to Read Them</a></li>
<li class="toctree-l1"><a class="reference internal" href="variable_metadata.html">Understanding the Variable Metadata</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="features_and_functionalities.html">Features and Functionalities</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="aerodynamics.html">Aerodynamics Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_aero.html">Externally Computed Polars</a></li>
<li class="toctree-l2"><a class="reference internal" href="propulsion.html">Propulsion</a></li>
<li class="toctree-l2"><a class="reference internal" href="mass.html">Mass Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="subsystems.html">SubsystemBuilderBase</a></li>
<li class="toctree-l2"><a class="reference internal" href="using_external_subsystems.html">Using external subsystems</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Step-by-step guide for creating, testing, and using external subsystems</a></li>
<li class="toctree-l2"><a class="reference internal" href="battery_subsystem_example.html">In-depth look at the battery subsystem as an example</a></li>
<li class="toctree-l2"><a class="reference internal" href="features/overriding.html">Overriding Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="FLOPS_based_detailed_takeoff_and_landing.html">FLOPS Based Detailed Takeoff and Landing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../examples/intro.html">Discussing the Aviary Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/simple_mission_example.html">Conventional Aircraft and Simple Mission</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/more_advanced_example.html">Optimizing the Mission Profile of a Conventional Aircraft</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/additional_flight_phases.html">Mission Optimization with Many Phases for a Commercial Aircraft</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/coupled_aircraft_mission_optimization.html">Coupled Aircraft-Mission Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/OAS_subsystem.html">Using Aviary and OpenAeroStruct Together</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Theory Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../theory_guide/intro.html">Overview of Aviary Functionality</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../theory_guide/underlying_concepts.html">Underlying Concepts</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../theory_guide/assumptions.html">Assumptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../theory_guide/aerodynamics.html">Core Aerodynamics Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../theory_guide/geometry.html">Core Geometry Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../theory_guide/mass.html">Core Mass Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../theory_guide/mission.html">Mission Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../theory_guide/propulsion.html">Core Propulsion Subsystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../theory_guide/optimization_algorithms.html">Optimization Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory_guide/validation.html">Validation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/codebase_overview.html">Codebase Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/coding_standards.html">Coding Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/unit_tests.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/contributing_guidelines.html">Guidelines for Contributing Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/how_to_contribute_docs.html">How to Contribute Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/debugging_env_from_github.html">Using Dev Environments from GitHub Actions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Miscellaneous Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../misc_resources/FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc_resources/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc_resources/resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc_resources/externally_supported_subsystems.html">Externally Supported Subsystems</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../misc_resources/feature_comparison.html">Feature Comparison with Legacy Codes</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../misc_resources/comparison_to_flops.html">Comparison to FLOPS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../misc_resources/planned_future_features.html">Planned Future Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_srcdocs/index.html">Source Docs</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/openmdao/Aviary" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/openmdao/Aviary/issues/new?title=Issue%20on%20page%20%2Fuser_guide/step_by_step_external_guide.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/user_guide/step_by_step_external_guide.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Step-by-step guide for creating, testing, and using external subsystems</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-plan-for-your-subsystem-integration">How to plan for your subsystem integration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-variables-for-aviary-to-use">Define variables for Aviary to use</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#making-openmdao-groups-for-your-subsystem">Making OpenMDAO groups for your subsystem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-subsystembuilderbase-class">Using the SubsystemBuilderBase class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-your-builder-and-ensuring-it-s-behaving-as-intended">Testing your builder and ensuring it’s behaving as intended</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-your-builder-within-aviary">Using your builder within Aviary</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="step-by-step-guide-for-creating-testing-and-using-external-subsystems">
<h1>Step-by-step guide for creating, testing, and using external subsystems<a class="headerlink" href="#step-by-step-guide-for-creating-testing-and-using-external-subsystems" title="Permalink to this heading">#</a></h1>
<section id="how-to-plan-for-your-subsystem-integration">
<h2>How to plan for your subsystem integration<a class="headerlink" href="#how-to-plan-for-your-subsystem-integration" title="Permalink to this heading">#</a></h2>
<p>You need to determine if your subsystem has a pre-mission aspect, a mission aspect, post-mission aspect, or any combination of these.
For example, if you are sizing a part of the aircraft, you might only need the pre-mission systems.
But if you’re trying to track the performance of a dynamic variable – something that varies across the mission – you’d want to add a dynamic aspect.
The most common and general subsystems have both pre-mission and mission systems.</p>
<p>The external subsystem interface allows you to provide OpenMDAO Systems (Groups or Components) for the pre-mission, mission, and post-mission parts of Aviary.
You’ll want to consider which parts of your model should live where.</p>
<p>It helps to diagram your model and break it down into <code class="docutils literal notranslate"><span class="pre">pre-mission</span></code>, <code class="docutils literal notranslate"><span class="pre">mission</span></code>, and <code class="docutils literal notranslate"><span class="pre">post-mission</span></code> systems that you’ll need.
I find XDSM diagrams very helpful for doing this as they have prescribed and clear formats that you can easily share with others.
See <a class="reference external" href="https://www.youtube.com/watch?v=yutKRwIL3BA">this video</a> for more information on understanding and creating XDSM diagrams.
Specifically think about the inputs and outputs to each one of these systems and what needs to be exposed to Aviary.</p>
<ol class="arabic simple">
<li><p>For <code class="docutils literal notranslate"><span class="pre">mission</span></code> systems, these would include anything that occurs during the flight of the aircraft. Thus, if you have n nodal mission analysis points, this system would be analyzed n times per mission. An example of mission systems include batteries, propulsion, sensors, thermal systems, and anything that varies in time.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pre-mission</span></code> systems include anything that happens before a mission is analyzed. This includes weights, structures, geometry, other one-time-per-optimization iteration analyses. <code class="docutils literal notranslate"><span class="pre">pre-mission</span></code> also includes anything associated with pre-flight systems. For example, if your takeoff analysis is analytic instead of mission-based, it would live here.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">post-mission</span></code> systems are evaluated after the mission is analyzed. This is useful for anything that needs the mission timeseries information, including acoustics, emissions, costs, etc.</p></li>
</ol>
</section>
<section id="define-variables-for-aviary-to-use">
<h2>Define variables for Aviary to use<a class="headerlink" href="#define-variables-for-aviary-to-use" title="Permalink to this heading">#</a></h2>
<p>Next up, define the variables that you will need for your model. You can use any sort of variables internally within your model, but if you want Aviary to know about the variables you must define them in a specific way. Specifically, if you use the Aviary naming convention of <code class="docutils literal notranslate"><span class="pre">'aircraft:...'</span></code> or <code class="docutils literal notranslate"><span class="pre">'mission:...'</span></code> and promote them out of your system, then other Aviary subsystems can see and use those values.</p>
<p>If your subsystem does not need to tell Aviary about any new variables (i.e. all of the variables that your system will use within Aviary already exist in Aviary itself), then you can skip this step. You will not need to add any variable or metadata info.</p>
<!-- TODO: add link to documentation about extending the variable hierarchy -->
<ol class="arabic">
<li><p>First, view the <a class="reference external" href="https://github.com/OpenMDAO/om-Aviary/blob/main/aviary/external_subsystems/battery/battery_variables.py">battery_variables.py file</a> to see an example of the variable hierarchy we use in Aviary. You can also look at the <a class="reference external" href="https://github.com/OpenMDAO/om-Aviary/blob/main/aviary/variable_info/variables.py">core Aviary variables</a> to see what’s available already. You can add any arbitrary system as a subclass within here. Items that define aircraft properties should go within <code class="docutils literal notranslate"><span class="pre">Aircraft</span></code> whereas any variables pertaining to the <code class="docutils literal notranslate"><span class="pre">Mission</span></code> should exist there.</p>
<p>These variable names are what’s used within the OpenMDAO system that Aviary uses. This sort of hierarchy is a purposeful design choice to make it clear what values live where, which subsystem they belong to, and that they are named the same between different systems. Additionally, we recommend including the legacy name of any variable you add that so that users of your builder will know how the variable names map to existing analyses.</p>
 <!-- TODO: add link to the variable hierarchy doc that includes how to use legacy_name  -->
</li>
<li><p>Now, with the variable names defined, we need to define variable metadata. Variable metadata helps Aviary understand your system. It also helps humans understand what units, defaults, and other values your variables use. Check out the <a class="reference external" href="https://github.com/OpenMDAO/om-Aviary/blob/main/aviary/external_subsystems/battery/battery_variable_meta_data.py">battery metadata example</a> as well as the <a class="reference external" href="https://github.com/OpenMDAO/om-Aviary/blob/main/aviary/variable_info/variable_meta_data.py">core Aviary metadata</a>.</p>
<p>When you define your variable metadata, you’ll use the same names you just defined. With those names, you’ll provide units, a brief description, and default values. You’re not locking yourself into specific units here, but by providing units then Aviary can convert the values behind-the-scenes to whatever units are actually used in the code. Users can input variables in any units that can be converted to those units prescribed in the metadata.</p>
</li>
</ol>
</section>
<section id="making-openmdao-groups-for-your-subsystem">
<h2>Making OpenMDAO groups for your subsystem<a class="headerlink" href="#making-openmdao-groups-for-your-subsystem" title="Permalink to this heading">#</a></h2>
<p>Once you’ve diagramed your model and defined your variables, create OpenMDAO Groups for each of the systems you need. Some disciplinary models may only need <code class="docutils literal notranslate"><span class="pre">pre-mission</span></code> systems, whereas others may need a different subset of these three possible systems. If you’re using a tool that already provides models in the OpenMDAO framework, you won’t have much (if any!) work to do here.</p>
<p>If you haven’t yet used OpenMDAO, definitely dig into <a class="reference external" href="http://openmdao.org/twodocs/versions/latest/main.html">its docs</a> or talk to somebody who has worked with it. These groups will be what Aviary adds to its own model.</p>
<p>To use gradient-based optimization in an efficient way, it greatly benefits you to provide derivatives for your model. It’s not strictly necessary, but the core Aviary tool has efficient derivative computations throughout. To take full computational advantage of this, your OpenMDAO models should also compute derivatives.</p>
</section>
<section id="using-the-subsystembuilderbase-class">
<h2>Using the SubsystemBuilderBase class<a class="headerlink" href="#using-the-subsystembuilderbase-class" title="Permalink to this heading">#</a></h2>
<p>Now we’ll create your subsystem builder. This is arguably the most important step since it exposes your model to Aviary using a consistent interface. The main idea surrounding the subsystem builder is that subject matter experts (you!) will create a specialized Python class that defines specific methods needed by Aviary to integrate your subsystem. I’ll walk you through this process now, but don’t worry – we also have some tests to help ensure your subsystem builder is set up correctly.</p>
<ol class="arabic">
<li><p>First, let’s work out some ground rules of the subsystem builder. You’ll inherit from <code class="docutils literal notranslate"><span class="pre">SubsystemBuilderBase</span></code> when you create your builder. This base class features <em>all</em> methods used by Aviary, even if your specific subsystem doesn’t need them (this varies on a subsystem to subsystem basis).</p></li>
<li><p>Most all of these methods are documented in-line, as well as on the doc page. I hope that you can follow those and understand what to do with your model, but if you can’t, please let us know your questions and we’ll rework these docs.</p></li>
<li><p>These methods can be roughly divided into three broad categories (shown in the graphic below):</p>
<ol class="arabic simple">
<li><p>Defining your subsystem</p></li>
<li><p>Telling Aviary about your design problem</p></li>
<li><p>Helping Aviary handle your subsystem</p></li>
</ol>
<p>Each one of these categories is only a notional way of organizing the methods, but I find it helpful to explain their general purposes.</p>
</li>
</ol>
<p><img alt="subsystem methods" src="../_images/external_subsystem_methods.png" /></p>
<p>To integrate external subsystems into Aviary, you need to use the <a class="reference internal" href="subsystems.html"><span class="doc std std-doc"><code class="docutils literal notranslate"><span class="pre">SubsystemBuilderBase</span></code> class</span></a> as a template for creating your builder object.
This class provides you with skeletal methods that you replace to specify the behavior of your subsystem.
The methods you should implement depend on what type of subsystem you’re building.</p>
</section>
<section id="testing-your-builder-and-ensuring-it-s-behaving-as-intended">
<h2>Testing your builder and ensuring it’s behaving as intended<a class="headerlink" href="#testing-your-builder-and-ensuring-it-s-behaving-as-intended" title="Permalink to this heading">#</a></h2>
<p>Okay, now we should test your subsystem builder to make sure it’s providing the correct outputs to Aviary. You don’t have to put it into Aviary (yet!) to do this. Look at the <a class="reference external" href="https://github.com/OpenMDAO/om-Aviary/blob/main/aviary/external_subsystems/battery/test_battery_builder.py"><code class="docutils literal notranslate"><span class="pre">test_battery_builder.py</span></code> file</a> to see how to test your subsystem. This is also detailed in the <a class="reference internal" href="battery_subsystem_example.html"><span class="doc std std-doc">battery subsystem example</span></a> doc page.</p>
<p>If everything goes well then those tests passed. If they didn’t, you should get some info about your builder that you can use to fix any bugs or errors.</p>
<p>This test probably won’t catch <em>everything</em> that could go wrong when interfacing your model with Aviary, but hopefully it catches the basic problems. If you reach an error that the test doesn’t help you with or it’s not clear what you need to do to fix your builder, please let us know!</p>
</section>
<section id="using-your-builder-within-aviary">
<h2>Using your builder within Aviary<a class="headerlink" href="#using-your-builder-within-aviary" title="Permalink to this heading">#</a></h2>
<p>Awesome. Let’s keep going and start to discuss using these subsystems within Aviary. The overarching idea is that now that you have a subsystem builder, you can pass an instantiation of this builder object to Aviary via the <code class="docutils literal notranslate"><span class="pre">phase_info</span></code> dictionary. Take a look at <a class="reference external" href="https://github.com/OpenMDAO/om-Aviary/blob/main/aviary/external_subsystems/battery/run_cruise.py"><code class="docutils literal notranslate"><span class="pre">run_cruise.py</span></code></a> and <a class="reference external" href="https://github.com/OpenMDAO/om-Aviary/blob/main/aviary/external_subsystems/battery/run_multiphase_mission.py"><code class="docutils literal notranslate"><span class="pre">run_multiphase_mission.py</span></code></a> to see how we do this for the battery model. Specifically, here are the relevant lines of code from the <code class="docutils literal notranslate"><span class="pre">run_cruise.py</span></code> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">battery_builder</span> <span class="o">=</span> <span class="n">BatteryBuilder</span><span class="p">()</span>

<span class="n">phase_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;pre_mission&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;include_takeoff&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;external_subsystems&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">battery_builder</span><span class="p">],</span>
        <span class="s1">&#39;optimize_mass&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;cruise&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="o">...</span>
        <span class="s1">&#39;external_subsystems&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">battery_builder</span><span class="p">],</span>
        <span class="o">...</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Those additional <code class="docutils literal notranslate"><span class="pre">'external_subsystems'</span></code> entires are where you add your subsystem instances. Let’s go through that step-by-step now.</p>
<ol class="arabic">
<li><p><strong>Add the <code class="docutils literal notranslate"><span class="pre">external_subsystems</span></code> list to your mission phases.</strong> For each disciplinary subsystem you’re adding, add them to the <code class="docutils literal notranslate"><span class="pre">external_subsystems</span></code> list. Each phase has its own <code class="docutils literal notranslate"><span class="pre">external_subsystems</span></code> list and this is on purpose. You may only care about your subsystem within a particular portion of the aircraft flight, or maybe you care about your subsystem throughout the entire flight. By defining the external subsystems on a phase-by-phase basis, you have exquisite control over where they’re added to Aviary. This is especially helpful for more computationally expensive subsystems.</p></li>
<li><p><strong>Add any <code class="docutils literal notranslate"><span class="pre">external_subsystems</span></code> to your pre- and post-mission phases too.</strong> If you have pre- or post-mission analyses in your subsystem, make sure to add the <code class="docutils literal notranslate"><span class="pre">external_subsystems</span></code> list to the <code class="docutils literal notranslate"><span class="pre">pre_mission</span></code> and <code class="docutils literal notranslate"><span class="pre">post_mission</span></code> sub-dicts within the <code class="docutils literal notranslate"><span class="pre">phase_info</span></code> dict. This means that Aviary will build and use those systems before or after the mission; otherwise Aviary won’t know to put the systems there.</p></li>
<li><p><strong>Start with a simple mission in Aviary.</strong> To begin, try adapting the <a class="reference external" href="https://github.com/OpenMDAO/om-Aviary/blob/main/aviary/external_subsystems/battery/run_cruise.py"><code class="docutils literal notranslate"><span class="pre">run_cruise.py</span></code></a> script to use your subsystem. Replace the <code class="docutils literal notranslate"><span class="pre">BatteryBuilder()</span></code> instance with your subsystem, for example. You might need other setup or inputs based on the complexity of your model. But in general, it helps to start with the simplest mission you can. In this case, that’s probably a steady level cruise flight.</p>
<p>Even though this is a “simple” mission, there’s still a lot that can go wrong. It turns out that designing an aircraft is challenging sometimes. I don’t expect your mission optimization to converge well your first try; it often takes some debugging and digging to get your subsystem integrated well. It’s really challenging to write docs to help you do this without knowing more about your system, what it’s trying to do while the aircraft is flying, and what you’ve already checked. That being said, make sure to reach out if you’re encountering problems here.</p>
</li>
<li><p><strong>Move on to a multi-phase mission.</strong> If you’re able to get a cruise-only mission converging well with your subsystem, next we should move on to a multiphase mission that features takeoff, climb, cruise, descent, and landing. This is much more representative of true aircraft performance (obviously) and generally puts your subsystem model to the test. This also introduces the idea of linking variables between mission phases, which introduces additional complexity to the model. For instance, your battery’s charge at the end of climb needs to match the battery’s charge at the beginning of cruise. Details like this can be tricky depending on your subsystem, so again this step often involves some debugging.</p></li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./user_guide"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="using_external_subsystems.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Using external subsystems</p>
      </div>
    </a>
    <a class="right-next"
       href="battery_subsystem_example.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">In-depth look at the battery subsystem as an example</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-plan-for-your-subsystem-integration">How to plan for your subsystem integration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-variables-for-aviary-to-use">Define variables for Aviary to use</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#making-openmdao-groups-for-your-subsystem">Making OpenMDAO groups for your subsystem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-subsystembuilderbase-class">Using the SubsystemBuilderBase class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-your-builder-and-ensuring-it-s-behaving-as-intended">Testing your builder and ensuring it’s behaving as intended</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-your-builder-within-aviary">Using your builder within Aviary</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Aviary team at NASA
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>